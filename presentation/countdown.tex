\begin{frame}
\frametitle{Step 2: Inverting the Hierarchies via \textbf{Countdown}}
\setbeamertemplate{enumerate items}[default]
\setbeamercolor{local structure}{fg=black}

\begin{enumerate}[\bfseries 1.]
	\itemsep 3ex
	\pause
	\item<come@6->
	\emph{What is inverse?} \textbf{Upper inverse and increasing functions}.
	
	\item<3->
	\emph{Can Repeater preserve Invertibility?} \textbf{Repeatable functions}.
	
	\item<4->
	\emph{Computing inverse with inverse:} \textbf{Contractions and Countdown}.
	
	\item<5->
	\textbf{Invert each level in hyperoperations/Ackermann hierarchies}.
\end{enumerate}
\end{frame}


\subsection{Upper Inverses and Increasing Functions}

\begin{frame}
\frametitle{Upper Inverses and Increasing Functions}
The \href{https://github.com/inv-ack/inv-ack/blob/7270e64a2600b771f2b1b1b151f7d13fb2ae6c97/inverse.v\#L28-L45}{
	\emph{upper inverse}} of $F$, written $F^{-1}$,
% {\color{red} $F^{-1}$, $F^{-1}_{\mathit{\shortuparrow}}$, $F^{-1}_{\upharpoonleft}$}
is \impinline{$\lambda n. \min\{m : F(m)\ge n\}$}.

%Note that $F^{-1}$ is a total function when $F$ is unbounded.

\bigskip

\pause 
\textbf{Increasing functions.} $F^{-1}$ makes sense and is total for \emph{strictly increasing} $F$ (hereafter referred to simply as \emph{increasing}).

\bigskip

\pause 
\begin{minipage}{0.4\linewidth}
	Analogy with inverse of \\
		     injections on real numbers:
\end{minipage} \ $\begin{cases}
\text{Increasing} & \hspace{-0.5em}\leftrightarrow \text{Injective} \\
\text{Upper Inverse} & \hspace{-0.5em}\leftrightarrow \text{Inverse}
\end{cases}$

\bigskip

\pause 
\textbf{\href{https://github.com/inv-ack/inv-ack/blob/7270e64a2600b771f2b1b1b151f7d13fb2ae6c97/inverse.v\#L65-L77}{Logical equivalence} (more useful)}: If $F:\mathbb{N}\to \mathbb{N}$ is increasing, \\
then $f = F^{-1}$ iff \impinline{$\forall n, m.~ f(n)\le m \iff n \le F(m)$}.

\end{frame}

\subsection*{}
\begin{frame}
\frametitle{Step 2: Inverting the Hierarchies via \textbf{Countdown}}
\setbeamertemplate{enumerate items}[default]
\setbeamercolor{local structure}{fg=black}

\begin{enumerate}[\bfseries 1.]
	\itemsep 3ex
	\item<done@1->
	\emph{What is inverse?} \textbf{Upper inverse and increasing functions}.
	
	\item<come@2->
	\emph{Can Repeater preserve Invertibility?} \textbf{Repeatable functions}.
	
	\item
	\emph{Computing inverse with inverse:} \textbf{Contractions and Countdown}.
	
	\item
	\textbf{Invert each level in hyperoperations/Ackermann hierarchies}.
\end{enumerate}
\end{frame}


\subsection{Expansions and Repeatable Functions}

\begin{frame}
\frametitle{Invertibility of the Hierarchies}

\textbf{Observation:} The first few hyperoperations (for $a\ge 2$) and \\ the first few levels of the Ackermann hierarchy are increasing. \\This means they are \emph{invertible}.

\bigskip

\pause 
\textbf{Generalization:} Does this hold forever?

\bigskip

\pause 
\imppar{\textbf{Key question:} Does Repeater preserve increasing-ness?}

%\bigskip
%
%\textbf{Repeatability:} a property that encompasses increasing-ness that is preserved through Repeater.
%\begin{equation*}
%Repeatable = Increasing + Strict \ Expanding
%\end{equation*}
%
%\textbf{Expansions:} A function $F:\mathbb{N}\to\mathbb{N}$ is an
%\href{https://github.com/inv-ack/inv-ack/blob/7270e64a2600b771f2b1b1b151f7d13fb2ae6c97/increasing_expanding.v\#L80-L82}{\emph{expansion}} if $\forall n.~ F(n)\ge n$. Further, for $a\in \mathbb{N}$, an expansion $F$ is
%\href{https://github.com/inv-ack/inv-ack/blob/7270e64a2600b771f2b1b1b151f7d13fb2ae6c97/increasing_expanding.v\#L84-L86}{\emph{strict from}} $a$ if ~$\forall n \ge a.~ F(n) > n$.
\end{frame}


\begin{frame}
\frametitle{Expansions and Repeatable Functions}

%\textbf{Observation:} The first few functions in the hyperoperations ($a\ge 2$) and the Ackermann hierarchy are increasing. Does this hold forever?
%
%\smallskip
%
%\textbf{Generalization:} How can Repeater preserve increasing-ness?
%
%\bigskip

%\textbf{Repeatability:} a property that encompasses increasing-ness that is preserved through Repeater.
Repeater preserves a stronger property!
\begin{equation*}
Repeatable \quad \triangleq \quad Increasing~~+~~Strict \ Expanding
\end{equation*}

\pause 
\textbf{Expansions:} A function $F:\mathbb{N}\to\mathbb{N}$ is an
\href{https://github.com/inv-ack/inv-ack/blob/7270e64a2600b771f2b1b1b151f7d13fb2ae6c97/increasing_expanding.v\#L80-L82}{\emph{expansion}} if $\forall n.~ F(n)\ge n$. Further, for $a\in \mathbb{N}$, an expansion $F$ is
\href{https://github.com/inv-ack/inv-ack/blob/7270e64a2600b771f2b1b1b151f7d13fb2ae6c97/increasing_expanding.v\#L84-L86}{\emph{strict from}} $a$ if ~$\forall n \ge a.~ F(n) > n$.

\bigskip

\pause 
\textbf{Repeatability:} An increasing function $f$ is \emph{repeatable} from $a$ \\provided that $f$ is also an expansion that is strict from $a$.

\smallskip

The set of functions repeatable from $a$ is denoted by $\repeatable_a$.

\end{frame}


\begin{frame}
\frametitle{Repeater Preserves Invertibility}
\label{frame:repeatable2}

\imppar{
\begin{minipage}{0.9\linewidth}
	\textbf{Repeatability Preservation Theorem.} $\forall a\ge 1$, if $f \in \repeatable_a$, then $\rf{f}{a} \in \repeatable_0$, meaning $\rf{f}{a}$~~is repeatable from any $b$.
\end{minipage}
}

\bigskip

\pause 
The levels $0, 1, 2$ in the hyperoperations (when $a\ge 2$) \\ are repeatable from their initial values.\\
So is level $0$ of the Ackermann hierarchy. 

\bigskip

\pause 
By induction, every hyperoperation level (when $a\ge 2$) and every Ackermann level is repeatable from its respective initial value.

\bigskip

\pause 
Our hunch is correct! In both hierarchies, every level is invertible.

\end{frame}


\subsection*{}
\begin{frame}
\frametitle{Step 2: Inverting the Hierarchies via \textbf{Countdown}}
\setbeamertemplate{enumerate items}[default]
\setbeamercolor{local structure}{fg=black}

\begin{enumerate}[\bfseries 1.]
	\itemsep 3ex
	\item<done@1->
	\emph{What is inverse?} \textbf{Upper inverse and increasing functions}.
	
	\item<done@1->
	\emph{Can Repeater preserve Invertibility?} \textbf{Repeatable functions}.
	
	\item<come@2->
	\emph{Computing inverse with inverse:} \textbf{Contractions and Countdown}.
	
	\item
	\textbf{Invert each level in hyperoperations/Ackermann hierarchies}.
\end{enumerate}
\end{frame}


\subsection{Contractions and Countdown}


\begin{frame}
\frametitle{Some Definitions}

\pause 
\textbf{Contraction.} A function $f : \mathbb{N} \to \mathbb{N}$ is a
\href{https://github.com/inv-ack/inv-ack/blob/7270e64a2600b771f2b1b1b151f7d13fb2ae6c97/countdown.v\#L40-L42}{\emph{contraction}} if $\forall n.~ f(n) \le n$.

Given an $a \ge 1$, a contraction $f$ is
\href{https://github.com/inv-ack/inv-ack/blob/7270e64a2600b771f2b1b1b151f7d13fb2ae6c97/countdown.v\#L44-L46}{\emph{strict above}} $a$ if $\forall n > a.~n > f(n)$.

\bigskip

\textbf{Notation.} Set of contractions strict above $a$ is denoted $\contract_a$.

\bigskip

\pause 
\textbf{Countdown.} Let $f\in \contract_a$. The \textit{countdown to} $a$ of $f$, written~$\cdt{f}{a}(n)$, is the smallest number of times $f$ needs to be compositionally applied to
$n$ for the answer to equal or go below $a$. \emph{i.e.},
\begin{equation*}
\cdt{f}{a}(n) \triangleq \min\{m: f^{(m)}(n)\le a \}.
\end{equation*}
\end{frame}


\begin{frame}
\frametitle{Countdown as the Inverse of Repeater}
\setlength{\leftmargini}{3.5em}
\setbeamertemplate{enumerate items}[default]
\setbeamercolor{local structure}{fg=black}

\textbf{Theorem.} $\forall a$, $\forall F\in \repeatable_a$, define $f\triangleq F^{-1}$. 
\\ Then $f\in \contract_a$ and $\cdt{f}{a}~ = \left(\rf{F}{a}\ \right)^{-1}$.

\bigskip

\pause 
\textbf{Proof.}

\begin{enumerate}[\itshape Step 1.]
	\pause 
	\item $f\in \contract$. \pause  $\forall n$, $F$ is an expansion $\implies n \le F(n)\implies f(n)\le n$.
	
	\smallskip
	
	\pause 
	\item $f\in \contract_a$. \pause Take $n> a$, since $F$ is strict from $a$, \pause
	\vspace{-1ex}
	\begin{equation*}
	\displayindent0pt
	\displaywidth\textwidth
	n-1 < F(n-1) \pause \implies n\le F(n-1) \pause \implies f(n)\le n - 1 \pause \implies f(n) < n.
	\end{equation*}
	\vspace{-3.5ex}
	\pause 
	\item $\cdt{f}{a}~ = \left(\rf{F}{a}\ \right)^{-1}$. \pause  We then have:
	\vspace{-1.5ex}
	\begin{equation*}
	\displayindent0pt
	\displaywidth\textwidth
	\begin{array}{cccll}
	& \cdt{f}{a}(n)\le m \pause & \iff f^{(m)}(n)\le a \pause & \iff f^{(m-1)}(n)\le F(a) 
	\pause & \iff \ldots \\
    \pause \iff & f(n)\le F^{(m-1)}(a) \pause & \iff n\le F^{(m)}(a) \pause & \iff n\le \rf{F}{a}(m) & \qed
	\end{array}
	\end{equation*}
\end{enumerate}

\end{frame}


\begin{frame}[fragile]
\frametitle{A Coq Computation of Countdown}
\textbf{Idea.} %To compute $\cdt{f}{a}(n)$,
Compute $f^{k}(n)$ for $k=0, 1,\ldots$ until $f^{(k)}(n)\le a$. Return $k$.

\bigskip

\pause 
\textbf{Primary issue.} Termination in Coq.
%Coq needs a known terminating point, i.e. an explicit decreasing argument. How to know when to terminate beforehand?

\bigskip

\textbf{Secondary issue.} It's hard to restrict $f$ to contractions only.
%It's hard to define a Coq definition of Countdown for contractions only. Defining a computation for \emph{all functions} that actually computes Countdown on contractions is easier.

\bigskip

\pause 
\textbf{The worker function.} $\begin{cases}
\text{Budget } b: & \hspace{-1em}\text{Maximum } b \text{ steps. } \\
\text{Step } i: & \hspace{-1em}\text{Compute } f^{(i)}(n). \\
\text{Stops when: } & \hspace{-1em}\text{budget reaches } 0 \text{ or } f^{(i)}(n) \le a.
\end{cases}$
%\bigskip
%\begin{itemize}
%	\item Budget $b$: Maximum $b$ steps.
%	\item Step $i$: Computes $\alpha_i(n)$.
%	\item Stops when budget reaches $0$ or $\alpha_i(n) \le i$.
%\end{itemize}

%A worker function takes $f, a, n$ and a budget $b$ and compute the chain $\{n, f(n), \ldots, f^{(b)}(n)\}$. It stops before reaching $f^{(b)}(n)$ upon encountering $k$ such that $f^{(k)}(n)\le a$.
%%TODO: Use bullet points

\bigskip

\pause 
\textbf{Primary issue.} How to determine a sufficient budget?
\end{frame}


\begin{frame}[fragile]
\frametitle{A Coq Computation of Countdown}

\textbf{The worker.}
%For any $a\in \mathbb{N}$ and $f: \mathbb{N}\to \mathbb{N}$, the
%\emph{countdown worker}
%to $a$ of $f$ is a function $\cdw{f}{a}\ : \mathbb{N}^2\to \mathbb{N}$ such that:
The \emph{countdown worker}
to $a$ of $f$ is a function $\cdw{f}{a}$~~:
\begin{equation*}
\cdw{f}{a}(n, b) = \begin{cases}
0 & \text{if } b = 0 \vee n\le a \\ 1 +\cdw{f}{a}(f(n), b-1) & \text{if } b \ge 1 \wedge n > a
\end{cases}
\end{equation*}

% Linked by A
\begin{lstlisting}
`\href{https://github.com/inv-ack/inv-ack/blob/7270e64a2600b771f2b1b1b151f7d13fb2ae6c97/countdown.v#L103-L108}{Fixpoint cdn\_wkr}` (a : nat) (f : nat -> nat) (n b : nat) : nat :=
  match b with 0 => 0 | S b' =>
    if (n <=? a) then 0 else S (cdn_wkr f a (f n) k')
end.
\end{lstlisting}

\bigskip

\pause 
\textbf{The Countdown.} Budget $b = n$ is sufficient.
\impinline{Redefine $\cdt{f}{a}(n) \triangleq \cdw{f}{a}(n, n)$.}
% Linked by A
\begin{lstlisting}
`\href{https://github.com/inv-ack/inv-ack/blob/7270e64a2600b771f2b1b1b151f7d13fb2ae6c97/countdown.v#L112}{Definition countdown\_to}` a f n := cdn_wkr a f n n.
\end{lstlisting}
\end{frame}




\subsection*{}
\begin{frame}
\frametitle{Step 2: Inverting the Hierarchies via \textbf{Countdown}}
\setbeamertemplate{enumerate items}[default]
\setbeamercolor{local structure}{fg=black}

\begin{enumerate}[\bfseries 1.]
	\itemsep 3ex
	\item<done@1->
	\emph{What is inverse?} \textbf{Upper inverse and increasing functions}.
	
	\item<done@1->
	\emph{Can Repeater preserve Invertibility?} \textbf{Repeatable functions}.
	
	\item<done@1->
	\emph{Computing inverse with inverse:} \textbf{Contractions and Countdown}.
	
	\item<come@2->
	\textbf{Invert each level in hyperoperations/Ackermann hierarchies}.
\end{enumerate}
\end{frame}


\subsection{Inverting the Hyperoperations/Ackermann Hierarchies}
\begin{frame}[fragile]
\frametitle{The Inverse Hyperoperation Hierarchy}
The inverse hyperoperations, written $a\angle{n}b$, are defined as:
\begin{equation*}
a\angle{n}b \; \triangleq \; \begin{cases}
b - 1 & \text{ if } n = 0 \\
\cdt{a\angle{n-1}}{a_n}(b) & \text{ if } n \ge 1
\end{cases}
\quad \text{ where } \ a_n = \begin{cases}
a & \hspace{-7pt}\text{ if } n = 1 \\
0 & \hspace{-7pt}\text{ if } n = 2 \\
1 & \hspace{-7pt}\text{ if } n \ge 3
\end{cases}
\end{equation*}
\vspace{-1em}
% linked by A
\pause 
\begin{lstlisting}
`\href{https://github.com/inv-ack/inv-ack/blob/7270e64a2600b771f2b1b1b151f7d13fb2ae6c97/applications.v#L28-L33}{Fixpoint inv\_hyperop}` (a n b : nat) : nat :=
  match n with 0 => b - 1 | S n' =>
    countdown_to (hyperop_init a n') (inv_hyperop a n') b
  end.
\end{lstlisting}

\smallskip

\pause 
Interesting individual levels:
$\href{https://github.com/inv-ack/inv-ack/blob/7270e64a2600b771f2b1b1b151f7d13fb2ae6c97/applications.v#L102-L113}{a\angle{2}b}
= \left\lceil b/a \right\rceil$,
$\href{https://github.com/inv-ack/inv-ack/blob/7270e64a2600b771f2b1b1b151f7d13fb2ae6c97/applications.v#L115-L124}{a\angle{3}b}
= \left\lceil \log_a b \right\rceil$, and
$\href{https://github.com/inv-ack/inv-ack/blob/7270e64a2600b771f2b1b1b151f7d13fb2ae6c97/applications.v#L126-L128}{a\angle{4}b}
= \log^*_a b$ (not currently in Coq standard library).
\end{frame}


\begin{frame}[fragile]
\frametitle{The Inverse Ackermann Hierarchy}

\textbf{Naive approach.} $\Ack_{i+1} = \rf{\big(\Ack_i\big)}{{\color<4->{red} \Ack_i(1)}}\ $.
\pause
Thus $\alpha_{i+1} \triangleq \cdt{\big(\alpha_i\big)}{{\color<4->{red} \Ack_i(1)}}\ $?\\ 

\smallskip

\pause
\textcolor{red}{\textbf{Flaw!}} $\alpha_{i+1}$ depends on {\color{red}$\Ack_i$}.

\bigskip

\pause 
\textbf{Observation.} $\Ack_{i+1}(n) = \Ack_i^{(n)}(\Ack_i(1)) = \Ack_i^{(n+1)}(1)$. \pause Thus
\vspace{-0.7em}
\begin{equation*}
\begin{aligned}
\alpha_{i+1}(n) & = \min\left\{m : n\le \Ack_i^{m+1}(1)\right\} \pause 
= \min\left\{m : \big( \alpha_i \big)^{(m+1)}(n)\le 1\right\} \pause \\
& = \min\left\{m : \big( \alpha_i \big)^{(m)}\big(\alpha_i(n)\big)\le 1\right\} \pause
= \cdt{\big(\alpha_i\big)}{1}\big(\alpha_i(n)\big)
\end{aligned}
\end{equation*}
\pause 
\textbf{Redefine:}
$
\alpha_i \triangleq
\begin{cases}
\lambda n.(n - 1) & \text{when } i = 0
\\ \big(\cdt{\alpha_{i-1}}{1}\big)\circ \alpha_{i-1} & \text{when } i\ge 1
\end{cases}
$

\smallskip

\pause 
% Linked by A
\begin{lstlisting}
`\href{https://github.com/inv-ack/inv-ack/blob/7270e64a2600b771f2b1b1b151f7d13fb2ae6c97/inv_ack.v#L37-L41}{Fixpoint alpha}` (m x : nat) : nat :=
  match m with 0 => x - 1 | S m' =>
    countdown_to 1 (alpha m') (alpha m' x)
end.
\end{lstlisting}
\end{frame}
